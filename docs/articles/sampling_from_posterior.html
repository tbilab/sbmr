<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sampling From Posterior • sbmr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Sampling From Posterior">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sbmr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/agglomerative_merging.html">Agglomerative Merging</a>
    </li>
    <li>
      <a href="../articles/bipartite_networks.html">bipartite_networks</a>
    </li>
    <li>
      <a href="../articles/sampling_from_posterior.html">Sampling From Posterior</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/tbilab/sbmr">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Sampling From Posterior</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tbilab/sbmr/blob/master/vignettes/sampling_from_posterior.Rmd"><code>vignettes/sampling_from_posterior.Rmd</code></a></small>
      <div class="hidden name"><code>sampling_from_posterior.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(sbmr)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(glue)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyr)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(purrr)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(forcats)</span></code></pre></div>
<p>In this document we will explore how to use the function <code><a href="../reference/mcmc_sweep.html">mcmc_sweep()</a></code> to sample from the posterior of a simulated network and investigate the results of doing so.</p>
<div id="setting-up-network-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-up-network-structure" class="anchor"></a>Setting up network structure</h2>
<p>First we will generate our simulated network. First we set a seed to make the structure reproducable and then we draw our random network using the <code><a href="../reference/sim_basic_block_network.html">sim_basic_block_network()</a></code> function to draw from a network with 3 groups and 40 nodes per group.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">42</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a>n_blocks &lt;-<span class="st"> </span><span class="dv">4</span>    <span class="co"># Total number of blocks</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>block_size &lt;-<span class="st"> </span><span class="dv">50</span> <span class="co"># How many nodes in each block</span></span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a>network &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_basic_block_network.html">sim_basic_block_network</a></span>(</span>
<span id="cb2-7"><a href="#cb2-7"></a>  <span class="dt">n_blocks =</span> n_blocks,     </span>
<span id="cb2-8"><a href="#cb2-8"></a>  <span class="dt">n_nodes_per_block =</span> block_size,  </span>
<span id="cb2-9"><a href="#cb2-9"></a>  <span class="dt">return_edge_propensities =</span> <span class="ot">TRUE</span>,</span>
<span id="cb2-10"><a href="#cb2-10"></a>  <span class="dt">random_seed =</span> <span class="dv">42</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>)</span></code></pre></div>
<p>First we can make sure our edge propensities look reasonable</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>network<span class="op">$</span>edge_propensities <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> block_<span class="dv">1</span>, <span class="dt">y =</span> block_<span class="dv">2</span>)) <span class="op">+</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">fill =</span> propensity)) <span class="op">+</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>()</span></code></pre></div>
<p><img src="sampling_from_posterior_files/figure-html/plot-edge-propensities-1.png" width="672"></p>
<p>Next, we can visualize the actual drawn network.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw"><a href="../reference/visualize_network.html">visualize_network</a></span>(network, <span class="dt">width =</span> <span class="st">'100%'</span>)</span></code></pre></div>
<p>We can see a decent amount of separation with perhaps more cohesion between the green and blue nodes than the orange</p>
<div id="initializing-the-chain-location" class="section level3">
<h3 class="hasAnchor">
<a href="#initializing-the-chain-location" class="anchor"></a>Initializing the chain location</h3>
<p>In an attempt to set our initial chain location to an optimal position we will agglomeratively merge the network using the collapse groups function. This will return a list of results for different model sizes.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>network &lt;-<span class="st"> </span>network <span class="op">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="st">  </span><span class="kw"><a href="../reference/collapse_blocks.html">collapse_blocks</a></span>(<span class="dt">report_all_steps =</span> <span class="ot">TRUE</span>, <span class="dt">sigma =</span> <span class="fl">1.1</span>)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>network <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="st">  </span><span class="kw"><a href="../reference/visualize_collapse_results.html">visualize_collapse_results</a></span>(<span class="dt">heuristic =</span> <span class="st">'dev_from_rolling_mean'</span>) <span class="op">+</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span>(<span class="dt">xintercept =</span> n_blocks, <span class="dt">color =</span> <span class="st">'orangered'</span>) <span class="op">+</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span>(<span class="dv">0</span>,<span class="dv">20</span>)</span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">#&gt; Warning: Removed 42 rows containing missing values (geom_point).</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt; Warning: Removed 21 row(s) containing missing values (geom_path).</span></span></code></pre></div>
<p><img src="sampling_from_posterior_files/figure-html/visualize-collapse-result-1.png" width="672"></p>
<p>So we can use the helper function <code><a href="../reference/choose_best_collapse_state.html">choose_best_collapse_state()</a></code> to scan through the results and find the optimal partitioning based upon the designated hueristic. The plot above is showing the score from the heuristic where the best collapse is determined by deviation from rolling mean (lower plot). Any scoring function can be provided as long as it takes as an argument the entropy column and or number of blocks column and returns a vector of scores where the highest value is the break to choosen.</p>
<p>Right now we will stick with the deviation from rolling mean to choose the best number of blocks.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>network &lt;-<span class="st"> </span>network <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="st">  </span><span class="kw"><a href="../reference/choose_best_collapse_state.html">choose_best_collapse_state</a></span>(<span class="dt">heuristic =</span> <span class="st">"dev_from_rolling_mean"</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co">#&gt; Choosing collapse with 4 blocks and an entropy of 1.3416.</span></span></code></pre></div>
</div>
<div id="visualizing-these-results-" class="section level3">
<h3 class="hasAnchor">
<a href="#visualizing-these-results-" class="anchor"></a>Visualizing these results.</h3>
<p>We can investigate the structure of this chosen partitioning against the true structure that we simulated using <code><a href="../reference/visualize_network.html">visualize_network()</a></code>…</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>true_to_inferred_table &lt;-<span class="st"> </span><span class="cf">function</span>(network){</span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">right_join</a></span>(<span class="kw"><a href="../reference/state.html">state</a></span>(network),</span>
<span id="cb8-3"><a href="#cb8-3"></a>             network<span class="op">$</span>nodes,</span>
<span id="cb8-4"><a href="#cb8-4"></a>             <span class="dt">by =</span> <span class="st">'id'</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(level <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="dt">inferred =</span> parent) <span class="op">%&gt;%</span><span class="st"> </span>{</span>
<span id="cb8-7"><a href="#cb8-7"></a>      <span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>(.<span class="op">$</span>inferred, .<span class="op">$</span>block)</span>
<span id="cb8-8"><a href="#cb8-8"></a>    }</span>
<span id="cb8-9"><a href="#cb8-9"></a>}</span>
<span id="cb8-10"><a href="#cb8-10"></a></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="kw">true_to_inferred_table</span>(network)</span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co">#&gt;              </span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">#&gt;               g1 g2 g3 g4</span></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co">#&gt;   bl_node_123  0  0 50  0</span></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co">#&gt;   bl_node_199  0  0  0 50</span></span>
<span id="cb8-16"><a href="#cb8-16"></a><span class="co">#&gt;   bl_node_4   50  0  0  0</span></span>
<span id="cb8-17"><a href="#cb8-17"></a><span class="co">#&gt;   bl_node_99   0 50  0  0</span></span></code></pre></div>
<p>So we already have an almost perfect separation into the 4 blocks. This should be a good starting place for our sampling.</p>
</div>
</div>
<div id="sampling-from-the-posterior" class="section level2">
<h2 class="hasAnchor">
<a href="#sampling-from-the-posterior" class="anchor"></a>Sampling from the posterior</h2>
<p>Now that we have our model in a starting place hopefully close to the median of the posterior we can initiate the MCMC sampling. We will start by doing a few sweeps to see if our model shape has stabalized at all.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>num_sweeps &lt;-<span class="st"> </span><span class="dv">20</span></span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a>network &lt;-<span class="st"> </span>network <span class="op">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="st">  </span><span class="kw"><a href="../reference/mcmc_sweep.html">mcmc_sweep</a></span>(<span class="dt">num_sweeps =</span> num_sweeps, </span>
<span id="cb9-5"><a href="#cb9-5"></a>             <span class="dt">eps =</span> <span class="fl">0.1</span>, </span>
<span id="cb9-6"><a href="#cb9-6"></a>             <span class="dt">track_pairs =</span> <span class="ot">FALSE</span>)</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a>network <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="st">  </span><span class="kw"><a href="../reference/visualize_mcmc_trace.html">visualize_mcmc_trace</a></span>() <span class="op">+</span></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(</span>
<span id="cb9-11"><a href="#cb9-11"></a>    <span class="dt">title =</span> glue<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span>(<span class="st">'Result of {num_sweeps} MCMC sweeps'</span>),</span>
<span id="cb9-12"><a href="#cb9-12"></a>    <span class="dt">subtitle =</span> <span class="st">"Entropy Delta of sweep and number of nodes moved for sweep"</span></span>
<span id="cb9-13"><a href="#cb9-13"></a>  )</span></code></pre></div>
<p><img src="sampling_from_posterior_files/figure-html/sample-from-posterior-low-eps-1.png" width="672"></p>
<p>So we get almost no movement at all, indicating the model has stuck into a local (in this case the global) minimum.</p>
<p>We can force it to explore a bit more by upping the epsilon value for the model.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>num_sweeps &lt;-<span class="st"> </span><span class="dv">20</span></span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>network &lt;-<span class="st"> </span>network <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="st">  </span><span class="kw"><a href="../reference/mcmc_sweep.html">mcmc_sweep</a></span>(<span class="dt">num_sweeps =</span> num_sweeps, </span>
<span id="cb10-5"><a href="#cb10-5"></a>             <span class="dt">eps =</span> <span class="dv">4</span>, </span>
<span id="cb10-6"><a href="#cb10-6"></a>             <span class="dt">track_pairs =</span> <span class="ot">FALSE</span>)</span>
<span id="cb10-7"><a href="#cb10-7"></a></span>
<span id="cb10-8"><a href="#cb10-8"></a>network <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="st">  </span><span class="kw"><a href="../reference/visualize_mcmc_trace.html">visualize_mcmc_trace</a></span>() <span class="op">+</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(</span>
<span id="cb10-11"><a href="#cb10-11"></a>    <span class="dt">title =</span> glue<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span>(<span class="st">'Result of {num_sweeps} MCMC sweeps, eps = 4'</span>),</span>
<span id="cb10-12"><a href="#cb10-12"></a>    <span class="dt">subtitle =</span> <span class="st">"Entropy Delta of sweep and number of nodes moved for sweep"</span></span>
<span id="cb10-13"><a href="#cb10-13"></a>  )</span></code></pre></div>
<p><img src="sampling_from_posterior_files/figure-html/sample-from-posterior-high-eps-1.png" width="672"></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">true_to_inferred_table</span>(network)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co">#&gt;              </span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co">#&gt;               g1 g2 g3 g4</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co">#&gt;   bl_node_123  0  0 50  0</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co">#&gt;   bl_node_199  0  0  0 50</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co">#&gt;   bl_node_4   50  0  0  0</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co">#&gt;   bl_node_99   0 50  0  0</span></span></code></pre></div>
<p>This increased epsilon value resulted in one block being split into two smaller ones. A thing to note however, even though we have more groups than we should, never have an infered group that spans more than a single true group.</p>
<div id="comparing-different-epsilons" class="section level3">
<h3 class="hasAnchor">
<a href="#comparing-different-epsilons" class="anchor"></a>Comparing different epsilons</h3>
<p>Let’s run 50 sweeps for a few different epsilon values and see how the traces compare.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Function to run n sweeps from a freshly initialized model</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>run_sweeps_at_eps &lt;-<span class="st"> </span><span class="cf">function</span>(eps, <span class="dt">num_sweeps =</span> <span class="dv">50</span>){</span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="co"># Refresh sbm to right after collapsing initialization</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="co"># and run sweeps at given epsilon value </span></span>
<span id="cb12-5"><a href="#cb12-5"></a>  network <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="st">    </span><span class="kw"><a href="../reference/choose_best_collapse_state.html">choose_best_collapse_state</a></span>(<span class="dt">heuristic =</span> <span class="st">"dev_from_rolling_mean"</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="st">    </span><span class="kw"><a href="../reference/mcmc_sweep.html">mcmc_sweep</a></span>(<span class="dt">num_sweeps =</span> num_sweeps, <span class="dt">eps =</span> eps) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="st">    </span><span class="kw"><a href="../reference/get_sweep_results.html">get_sweep_results</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="st">    </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span>(<span class="st">'sweep_info'</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">sweep =</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/n.html">n</a></span>(), <span class="dt">label =</span> glue<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span>(<span class="st">'eps = {eps}'</span>))</span>
<span id="cb12-11"><a href="#cb12-11"></a>}</span>
<span id="cb12-12"><a href="#cb12-12"></a></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dt">from =</span> <span class="fl">0.1</span>, <span class="dt">to =</span> <span class="dv">10</span>, <span class="dt">length.out =</span> <span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span>(run_sweeps_at_eps) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-15"><a href="#cb12-15"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">label =</span> forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(label))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> sweep, <span class="dt">y =</span> entropy_delta)) <span class="op">+</span></span>
<span id="cb12-17"><a href="#cb12-17"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>() <span class="op">+</span></span>
<span id="cb12-18"><a href="#cb12-18"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(label<span class="op">~</span>.)</span>
<span id="cb12-19"><a href="#cb12-19"></a><span class="co">#&gt; Warning in bind_rows_(x, .id): Vectorizing 'glue' elements may not preserve</span></span>
<span id="cb12-20"><a href="#cb12-20"></a><span class="co">#&gt; their attributes</span></span>
<span id="cb12-21"><a href="#cb12-21"></a></span>
<span id="cb12-22"><a href="#cb12-22"></a><span class="co">#&gt; Warning in bind_rows_(x, .id): Vectorizing 'glue' elements may not preserve</span></span>
<span id="cb12-23"><a href="#cb12-23"></a><span class="co">#&gt; their attributes</span></span>
<span id="cb12-24"><a href="#cb12-24"></a></span>
<span id="cb12-25"><a href="#cb12-25"></a><span class="co">#&gt; Warning in bind_rows_(x, .id): Vectorizing 'glue' elements may not preserve</span></span>
<span id="cb12-26"><a href="#cb12-26"></a><span class="co">#&gt; their attributes</span></span>
<span id="cb12-27"><a href="#cb12-27"></a></span>
<span id="cb12-28"><a href="#cb12-28"></a><span class="co">#&gt; Warning in bind_rows_(x, .id): Vectorizing 'glue' elements may not preserve</span></span>
<span id="cb12-29"><a href="#cb12-29"></a><span class="co">#&gt; their attributes</span></span></code></pre></div>
<p><img src="sampling_from_posterior_files/figure-html/compare-eps-values-1.png" width="672"></p>
<p>As expected the lines get less stable as epsilon increases.</p>
</div>
</div>
<div id="pairwise-block-consensus" class="section level2">
<h2 class="hasAnchor">
<a href="#pairwise-block-consensus" class="anchor"></a>Pairwise block consensus</h2>
<p>The <code><a href="../reference/mcmc_sweep.html">mcmc_sweep()</a></code> method has an option to keep track of how connected each node is with all other nodes. The idea being that the more frequently that two nodes are in the same block together, the more confident the model is that they are truly connected. We can visualize this by accessing the <code>pairing_counts</code> dataframe attached to the outputs of <code><a href="../reference/mcmc_sweep.html">mcmc_sweep()</a></code> with <code>track_pairs = TRUE</code>.</p>
<p>First we will run one hundred sweeps for nodes with epsilon set to 0.5.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>network &lt;-<span class="st"> </span>network <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="st">  </span><span class="kw"><a href="../reference/choose_best_collapse_state.html">choose_best_collapse_state</a></span>(<span class="dt">heuristic =</span> <span class="st">"dev_from_rolling_mean"</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="st">  </span><span class="kw"><a href="../reference/mcmc_sweep.html">mcmc_sweep</a></span>(<span class="dt">num_sweeps =</span> <span class="dv">100</span>, <span class="dt">eps =</span> <span class="fl">0.5</span>, <span class="dt">track_pairs =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>Then we can look at the supplied <code>pairing_counts</code> dataframe to see how often pairwise nodes are connected to eachother.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>network <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="st">  </span><span class="kw"><a href="../reference/get_sweep_pair_counts.html">get_sweep_pair_counts</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> node_a, <span class="dt">y =</span> node_b, <span class="dt">fill =</span> proportion_connected)) <span class="op">+</span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster</a></span>() <span class="op">+</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(</span>
<span id="cb14-6"><a href="#cb14-6"></a>    <span class="dt">axis.text =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),</span>
<span id="cb14-7"><a href="#cb14-7"></a>    <span class="dt">axis.ticks =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>()</span>
<span id="cb14-8"><a href="#cb14-8"></a>  ) <span class="op">+</span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="dt">x =</span> <span class="st">"node a"</span>, </span>
<span id="cb14-10"><a href="#cb14-10"></a>       <span class="dt">y =</span> <span class="st">"node b"</span>,</span>
<span id="cb14-11"><a href="#cb14-11"></a>       <span class="dt">fill =</span> <span class="st">"Proportion of sweeps</span><span class="ch">\n</span><span class="st">in same block"</span>,</span>
<span id="cb14-12"><a href="#cb14-12"></a>       <span class="dt">title =</span> <span class="st">"Node block consensus matrix"</span>,</span>
<span id="cb14-13"><a href="#cb14-13"></a>       <span class="dt">subtitle =</span> glue<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span>(<span class="st">"True number of blocks: {n_blocks}"</span>))</span></code></pre></div>
<p><img src="sampling_from_posterior_files/figure-html/visualize-pair-matrix-1.png" width="672"></p>
<p>Another method to investigate these block concensus results is to look at the ECDF of the node connection probabilities.</p>
<p>A good behavior indicating there are strong clusters in your data is an ECDF that has a large flat section in the middle, indicating that almost all of your node connection propensities are close to zero or close to one. We can look at this for our mcmc results as well. This functionality is supplied with the function <code><a href="../reference/visualize_propensity_dist.html">visualize_propensity_dist()</a></code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw"><a href="../reference/visualize_propensity_dist.html">visualize_propensity_dist</a></span>(network)</span></code></pre></div>
<p><img src="sampling_from_posterior_files/figure-html/visualize-pair-dist-1.png" width="672"></p>
<p>So we see a very strong flat line from zero all the way to a small bump at around 0.65 and then again a sharp bump right at one. This indicates that a few nodes sometimes split off into other groups.</p>
<p>A last way of looking at this is to create a new network from our data. This time drawing an edge between two nodes if their pairwise connection probability was above some threshold. Once we have this network we can plot it and see if isolated subgraphs appear in the network. Deciding any threshold is fraught with danger, but if we keep it small we should be in the clear. This investigation is provided with the function <code><a href="../reference/visualize_propensity_network.html">visualize_propensity_network()</a></code>.</p>
<p>Let’s check our MCMC sweep results with it…</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw"><a href="../reference/visualize_propensity_network.html">visualize_propensity_network</a></span>(network)</span></code></pre></div>
<p>So we can see that we have perfect separation into our true groups using this isolated subgraph investigation.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#setting-up-network-structure">Setting up network structure</a></li>
      <li><a href="#sampling-from-the-posterior">Sampling from the posterior</a></li>
      <li><a href="#pairwise-block-consensus">Pairwise block consensus</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nick Strayer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
